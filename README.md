# 基于Gin+Vue的智能网盘系统

## 概述
网盘系统本质是对文件的CURD，但是由于文件的可能很大，所以并不是简单的CRUD，需要做一些额外的优化，核心操作在于：
- 文件上传
- 文件下载
- 文件存储/备份

并且对于删除操作增加了回收站的功能。

# 中间件
- mysql（用户表，用户文件表-维护用户的目录逻辑，全局文件表）
- redis（Hset 记录上传的进度）
- mq（将文件上传和文件备份解耦合）

# 文件上传
### 涉及到的功能：分块上传，断点续传，秒传
上传文件的过程分为三个请求；
### 初始化文件
前端提交文件的元信息（名称，Hash值，大小）发送到后端，后端首先查表寻找该文件是否已经存在，若存在，直接触发**秒传**，直接在用户文件表中加一个和该文件的对应关系即可，若没有进行后续步骤。

用户查询redis中有没有该文件的信息（HGET 文件Hash），若存在，触发**断点续传**，将已存在的分片index发送给前端，当前端进行第二步-分片上传的过程中，遇到已经存在于集合中的index分片，直接跳过即可。

redis中若不存在该文件的信息，进行普通**分块上传**，后端进行分片计算，并将分片大小，分片个数等信息返回给前端，前端后续根据该信息进行分片提交。

### 上传分片
前端循环将每个分片进行提交，后端接收到分片之后，将分片内容写入upload/temp/文件Hash/分片index 临时文件中，并且在redis中记录分片信息（HSET 文件Hash chunk_idx1,1）

### 合并分片
首先在redis中检查已上传分片的个数，和预计分片个数比对，若个数相对则进行合并，读取可以分片内容并写入真实文件中（upload/文件Hash）,删除临时的分片信息，并且删除redis中的进度记录，将该文件信息分别写入用户文件表和全局文件表。


